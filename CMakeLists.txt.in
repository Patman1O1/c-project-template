#-----------------------------------------------------------------------------------------------------------------------
# Information
#-----------------------------------------------------------------------------------------------------------------------
cmake_minimum_required_(VERSION @CMAKE_MINIMUM_REQUIRED_VERSION@)
project(@PROJECT_NAME@
        VERSION @PROJECT_VERSION@
        DESCRIPTION @PROJECT_DESCRIPTION@
        LANGUAGES C
)

cmake_file_api(
        QUERY
        API_VERSION 1
        CODEMODEL 2.3
)

# Ensure the project has a namespace
if(NOT DEFINED PROJECT_NAMESPACE)
    set(PROJECT_NAMESPACE "${PROJECT_NAME_PASCAL_CASE}" CACHE STRING "The project's namespace")
endif()

#-----------------------------------------------------------------------------------------------------------------------
# Settings
#-----------------------------------------------------------------------------------------------------------------------
# C Settings
set(CMAKE_C_STANDARD @CMAKE_C_STANDARD@)
set(CMAKE_C_STANDARD_REQUIRED ON)

# Project Settings
option(BUILD_SHARED_LIBS "Build the project as a shared library" @BUILD_SHARED_LIBS@)
option(BUILD_TEST "Build the project's tests" OFF)

# Set default build type if not specified
if(NOT DEFINED CMAKE_BUILD_TYPE AND NOT DEFINED CMAKE_CONFIGURATION_TYPES)
    set(CMAKE_BUILD_TYPE Release CACHE STRING "Build type" FORCE)
    set_property(CACHE CMAKE_BUILD_TYPE PROPERTY STRINGS "Debug" "Release" "MinSizeRel" "RelWithDebInfo")
endif()

#-----------------------------------------------------------------------------------------------------------------------
# Project Initialization
#-----------------------------------------------------------------------------------------------------------------------
@PROJECT_INIT@

#-----------------------------------------------------------------------------------------------------------------------
# CCache
#-----------------------------------------------------------------------------------------------------------------------
find_program(CCACHE_PROGRAM ccache)
if(CCACHE_PROGRAM)
    message(STATUS "CCache found")
    set(CMAKE_C_COMPILER_LAUNCHER "${CCACHE_PROGRAM}")
    set(CMAKE_CXX_COMPILER_LAUNCHER "${CCACHE_PROGRAM}")
else()
    message(STATUS "CCache not found")
endif()

#-----------------------------------------------------------------------------------------------------------------------
# Interprocedural Optimisation (IPO)
#-----------------------------------------------------------------------------------------------------------------------
include(CheckIPOSupported)
check_ipo_supported(RESULT result OUTPUT output)
if(result)
    message(STATUS "IPO is available")
    set(CMAKE_INTERPROCEDURAL_OPTIMIZATION TRUE)
else()
    message(SEND_ERROR "IPO is unavailable: ${output}")
endif()

#-----------------------------------------------------------------------------------------------------------------------
# CPack
#-----------------------------------------------------------------------------------------------------------------------
include(CPack)
set(CPACK_PROJECT_NAME "${PROJECT_NAME}")
set(CPACK_PROJECT_VERSION ${PROJECT_VERSION})
set(CPACK_RESOURCE_FILE_LICENSE "${CMAKE_SOURCE_DIR}/LICENSE")
set(CPACK_RESOURCE_FILE_README "${CMAKE_SOURCE_DIR}/README.md")
set(CPACK_SOURCE_IGNORE_FILES
        /.git
        /.vscode
        /.*build.*
        /\\\\.gitignore
        /\\\\.DS_Store
)

#-----------------------------------------------------------------------------------------------------------------------
# Subdirectories
#-----------------------------------------------------------------------------------------------------------------------
add_subdirectory("src")

if(BUILD_TEST)
    add_subdirectory("test")
endif()

